<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Performance &mdash; Check the Chain (ctc)  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Monitoring" href="monitoring.html" />
    <link rel="prev" title="Storing Data" href="storing_data.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Check the Chain (ctc)
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/dependencies.html">Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data &amp; Ops</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="obtaining_data.html">Obtaining Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="storing_data.html">Storing Data</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitoring.html">Monitoring</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Command Line Interface</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cli/basic_usage.html">Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/subcommands.html">Subcommands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/useful_aliases.html">Useful Aliases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/similar_tools.html">Similar CLI tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python Interface</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../python/code_tour.html">Codebase Tour</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/rpc_client.html">RPC Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/async_code.html">Asynchronous Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/datatypes.html">Datatypes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/specific_protocols.html">Specific Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/similar_tools.html">Similar Python Tools</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Check the Chain (ctc)</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Performance</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/data_ops/performance.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="performance">
<h1>Performance<a class="headerlink" href="#performance" title="Permalink to this headline"></a></h1>
<div class="admonition-tldr admonition">
<p class="admonition-title">TLDR</p>
<p>Even in suboptimal conditions, <code class="docutils literal notranslate"><span class="pre">ctc</span></code> uses optimizations that allow running many types of workloads at acceptable levels of performance. This page is for those who wish to squeeze additional performance out of <code class="docutils literal notranslate"><span class="pre">ctc</span></code>.</p>
</div>
<div class="section" id="optimizing-performance">
<h2>Optimizing Performance<a class="headerlink" href="#optimizing-performance" title="Permalink to this headline"></a></h2>
<p>There are many levers and knobs available for tuning <code class="docutils literal notranslate"><span class="pre">ctc</span></code>’s performance.</p>
<div class="section" id="rpc-provider">
<h3>RPC Provider<a class="headerlink" href="#rpc-provider" title="Permalink to this headline"></a></h3>
<p>Different 3rd party RPC providers can vary significantly in their reliability and speed. For example, some providers have trouble with large historical queries.</p>
<p>Operations in <code class="docutils literal notranslate"><span class="pre">ctc</span></code> that fetch external data are usually bottlenecked by the RPC provider, specifically the latency to the RPC provider. This latency can be reduced by running <code class="docutils literal notranslate"><span class="pre">ctc</span></code> as closely as possible to the archive node:</p>
<ul class="simple">
<li><p>Fastest = running ctc on the same server that is running the archive node</p></li>
<li><p>Fast = running ctc on the same local network as the archive node</p></li>
<li><p>Slower = running ctc in the same geographic region as the archive node</p></li>
<li><p>Slowest = running ctc in a different geographic region than the archive node</p></li>
</ul>
<p>If using a 3rd party RPC provider, you should inquire about where their nodes are located and plan accordingly.</p>
<p><code class="docutils literal notranslate"><span class="pre">ctc</span></code>’s default configuration assumes that the user is querying an RPC node on a remote network. This leads <code class="docutils literal notranslate"><span class="pre">ctc</span></code> to locally store lots of the data that it retrieves. However, it’s possible that different tradeoffs are relevant in heavily optimized setups. For example if <code class="docutils literal notranslate"><span class="pre">ctc</span></code> is run on the same server as an archive node, then some caches might hurt more than they help. Cache settings are altered using <code class="docutils literal notranslate"><span class="pre">ctc</span> <span class="pre">setup</span></code> on the command line.</p>
</div>
<div class="section" id="python-versions">
<h3>Python Versions<a class="headerlink" href="#python-versions" title="Permalink to this headline"></a></h3>
<p>More recent versions of python are generally faster. Upgrading to the latest python version is one of the easiest ways to improve code performance. In particular, the upcoming python 3.11 has much faster startup times and shows improvement across many benchmarks. This makes <code class="docutils literal notranslate"><span class="pre">ctc</span></code>’s cli commands feel especially quick and responsive.</p>
</div>
<div class="section" id="python-packages">
<h3>Python Packages<a class="headerlink" href="#python-packages" title="Permalink to this headline"></a></h3>
<p>By default, <code class="docutils literal notranslate"><span class="pre">ctc</span></code> tries to minimize its dependencies and minimize the number of build steps that happen during installation. This does carry a bit of performance cost. Faster versions of various packages can be installed using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install checkthechain<span class="o">[</span>performance<span class="o">]</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">ctc</span></code> detects that these additional performance packages are installed, it will use those instead of the default packages. This can produce a modest performance increase for some workloads.</p>
</div>
<div class="section" id="data-storage">
<h3>Data Storage<a class="headerlink" href="#data-storage" title="Permalink to this headline"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ctc</span></code>’s default data directory is <code class="docutils literal notranslate"><span class="pre">~/.config/ctc/</span></code> in the user’s home directory. If this directory is on a slow drive (especially a network drive), this will negatively impact performance. To optimize performance, place the data directory on as fast a drive as possible. This can be done by running the setup wizard <code class="docutils literal notranslate"><span class="pre">ctc</span> <span class="pre">setup</span></code>.</p>
</div>
<div class="section" id="data-caching">
<h3>Data Caching<a class="headerlink" href="#data-caching" title="Permalink to this headline"></a></h3>
<p>For tasks that require many RPC requests, or require lots of post-processing (or are demanding in other ways), you should consider caching the result in-memory or on-disk. One way to do this is with the <a class="reference external" href="https://github.com/sslivkoff/toolcache">toolcache</a> package. With <code class="docutils literal notranslate"><span class="pre">toolcache</span></code> a simple decorator adds an in-memory or on-disk cache to the expensive function.</p>
<p>For example, if you are using <code class="docutils literal notranslate"><span class="pre">ctc</span></code> to create data payloads for a historical analytics dashboard, you might use a pattern similar to this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">toolcache</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">create_data_payload</span><span class="p">(</span><span class="n">timestamps</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">compute_timestamp_stats</span><span class="p">(</span><span class="n">timestamp</span><span class="o">=</span><span class="n">timestamp</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">timestamp</span> <span class="ow">in</span> <span class="n">timestamps</span>
    <span class="p">]</span>


<span class="c1"># create an on-disk cache entry for each timestamp</span>
<span class="nd">@toolcache</span><span class="o">.</span><span class="n">cache</span><span class="p">(</span><span class="s1">&#39;disk&#39;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">compute_timestamp_stats</span><span class="p">(</span><span class="n">timestamp</span><span class="p">):</span>
    <span class="n">super_expensive_operation</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="logging">
<h3>Logging<a class="headerlink" href="#logging" title="Permalink to this headline"></a></h3>
<p>Logging of RPC requests and SQL queries takes up a non-zero amount of resources. If you don’t need logging, disabling it can squeeze out a bit of extra performance. This can be done by running the setup wizard <code class="docutils literal notranslate"><span class="pre">ctc</span> <span class="pre">setup</span></code>.</p>
</div>
</div>
<div class="section" id="benchmarking-performance">
<h2>Benchmarking Performance<a class="headerlink" href="#benchmarking-performance" title="Permalink to this headline"></a></h2>
<p>To truly optimize your environment and implementation, you will need to run your own benchmarks.</p>
<div class="section" id="benchmarking-speed">
<h3>Benchmarking Speed<a class="headerlink" href="#benchmarking-speed" title="Permalink to this headline"></a></h3>
<p>The simplest way to benchmark the speed of a CLI command is <code class="docutils literal notranslate"><span class="pre">time</span></code>. Running <code class="docutils literal notranslate"><span class="pre">time</span> <span class="pre">&lt;command&gt;</span></code> will run a given command and report the run time.
Benchmarking speed of python code snippets is slightly more complicated but also has many tools available:</p>
<ol class="arabic simple">
<li><p>Synchronous code can be easily profiled used IPython’s built-in magics <code class="docutils literal notranslate"><span class="pre">%timeit</span></code>, <code class="docutils literal notranslate"><span class="pre">%%timeit</span></code>, <code class="docutils literal notranslate"><span class="pre">%prun</span></code>, and <code class="docutils literal notranslate"><span class="pre">%%prun</span></code></p></li>
<li><p>If using a Jupyter notebook, the <a class="reference external" href="https://jupyter-contrib-nbextensions.readthedocs.io/en/latest/nbextensions/execute_time/readme.html">Execute Time</a> extension can be extremely useful for getting a crude estimate of how long each code cell takes to run. This works for both synchronous and asynchronous code.</p></li>
<li><p>For a more programmatic approach you can use <a class="reference external" href="https://docs.python.org/3/library/profile.html">python’s built-in profilers</a> or 3rd party profilers such as <a class="reference external" href="https://github.com/plasma-umass/scalene">Scalene</a> or <a class="reference external" href="https://github.com/uber-archive/pyflame">pyflame</a>.</p></li>
</ol>
</div>
<div class="section" id="measuring-storage-usage">
<h3>Measuring Storage Usage<a class="headerlink" href="#measuring-storage-usage" title="Permalink to this headline"></a></h3>
<p>It is also valuable to measure <code class="docutils literal notranslate"><span class="pre">ctc</span></code>’s storage usage to check whether it falls into an acceptable range for a given hardware setup. Storage usage in the <code class="docutils literal notranslate"><span class="pre">ctc</span></code> data folder can be found by running a storage profiling command like <code class="docutils literal notranslate"><span class="pre">du</span> <span class="pre">-h</span></code> or <a class="reference external" href="https://github.com/bootandy/dust"><code class="docutils literal notranslate"><span class="pre">dust</span></code></a>. Storage usage in databases can be found by running <code class="docutils literal notranslate"><span class="pre">ctc</span> <span class="pre">db</span> <span class="pre">storage</span></code>.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="storing_data.html" class="btn btn-neutral float-left" title="Storing Data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="monitoring.html" class="btn btn-neutral float-right" title="Monitoring" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>